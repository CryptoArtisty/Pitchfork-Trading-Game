<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆüìà Pitchfork Strategy Trading Assistant</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
       
        body {
            font-family: 'Inter', sans-serif;
        }
       
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
       
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
       
        .achievement-popup {
            animation: achievementSlide 0.5s ease-out;
        }
       
        @keyframes achievementSlide {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
       
        .confetti {
            position: fixed;
            width: 8px;
            height: 8px;
            background: #f39c12;
            animation: confettiFall 3s linear forwards;
            z-index: 1000;
        }
       
        @keyframes confettiFall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
       
        .pulse {
            animation: pulse 2s infinite;
        }
       
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }
       
        .candlestick {
            display: inline-block;
            position: relative;
            margin: 0 2px;
        }
       
        .candle-body {
            width: 12px;
            height: 30px;
            border-radius: 2px;
        }
       
        .candle-wick {
            width: 2px;
            background: #374151;
            position: absolute;
            left: 5px;
        }
       
        .green-candle {
            background: #10b981;
        }
       
        .red-candle {
            background: #ef4444;
        }
       
        .doji-candle {
            background: #374151;
            height: 2px;
            width: 12px;
            position: relative;
            top: 14px;
        }
       
        .tab-button {
            transition: all 0.3s ease;
        }
       
        .tab-button:hover {
            transform: translateY(-2px);
        }
       
        .stat-card {
            transition: all 0.3s ease;
        }
       
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
       
        .emotion-btn {
            transition: all 0.2s ease;
        }
       
        .emotion-btn:hover {
            transform: scale(1.2);
        }
       
        .progress-ring {
            transform: rotate(-90deg);
        }
       
        .progress-ring-circle {
            transition: stroke-dasharray 0.5s ease;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .star-rating {
            display: flex;
            gap: 2px;
        }

        .star {
            cursor: pointer;
            font-size: 1.5rem;
            color: #d1d5db;
            transition: color 0.2s ease;
        }

        .star:hover,
        .star.active {
            color: #fbbf24;
        }

        .trade-entry {
            transition: all 0.3s ease;
        }

        .trade-entry:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .edit-mode {
            background-color: #fef3c7 !important;
            border: 2px solid #f59e0b !important;
        }

        .strategy-complete {
            background: linear-gradient(45deg, #10b981, #059669);
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from {
                box-shadow: 0 0 20px rgba(16, 185, 129, 0.5);
            }
            to {
                box-shadow: 0 0 30px rgba(16, 185, 129, 0.8);
            }
        }

        .discipline-badge {
            background: linear-gradient(45deg, #8b5cf6, #a855f7);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }
       
        @media print {
            body {
                background: white !important;
            }
            .no-print {
                display: none !important;
            }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- Fixed Status Bar -->
    <div class="fixed top-0 left-0 right-0 z-50 glass-effect shadow-lg no-print">
        <div class="max-w-7xl mx-auto px-4 py-3 flex flex-wrap items-center justify-between gap-4">
            <div class="flex items-center gap-4">
                <div class="flex items-center gap-2 bg-indigo-100 rounded-full px-3 py-1">
                    <i class="fas fa-star text-yellow-500"></i>
                    <span class="font-semibold text-indigo-800">XP: <span id="xpValue">0</span></span>
                </div>
                <div class="flex items-center gap-2 bg-purple-100 rounded-full px-3 py-1">
                    <i class="fas fa-trophy text-purple-600"></i>
                    <span class="font-semibold text-purple-800">Level: <span id="levelValue">1</span></span>
                </div>
                <div class="flex items-center gap-2 bg-red-100 rounded-full px-3 py-1">
                    <i class="fas fa-fire text-red-500"></i>
                    <span class="font-semibold text-red-800">Streak: <span id="streakValue">0</span></span>
                </div>
                <div class="flex items-center gap-2 bg-green-100 rounded-full px-3 py-1">
                    <i class="fas fa-chart-line text-green-600"></i>
                    <span class="font-semibold text-green-800">Discipline: <span id="disciplineScore">100%</span></span>
                </div>
            </div>
            <div class="flex items-center gap-2">
                <div class="w-32 bg-gray-200 rounded-full h-2">
                    <div id="progressBar" class="bg-gradient-to-r from-indigo-500 to-purple-600 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>
                <span class="text-sm font-medium text-gray-700" id="progressText">0%</span>
            </div>
        </div>
    </div>

    <!-- Achievement Popup -->
    <div id="achievementPopup" class="fixed top-20 right-4 z-50 bg-green-500 text-white p-4 rounded-lg shadow-xl achievement-popup transform translate-x-full opacity-0 transition-all duration-500 no-print">
        <div class="flex items-center gap-3">
            <i class="fas fa-trophy text-2xl"></i>
            <div>
                <h4 id="achievementTitle" class="font-bold text-lg">Achievement Unlocked!</h4>
                <p id="achievementDesc" class="text-sm opacity-90">Description</p>
                <p class="text-sm font-semibold">+<span id="achievementXP">0</span> XP</p>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="max-w-7xl mx-auto px-4 pt-24 pb-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl md:text-6xl font-bold text-white mb-4">
                üéÆüìà Pitchfork Strategy Trading Game
            </h1>
            <p class="text-xl text-white opacity-90 max-w-2xl mx-auto">
                Master the art of pitchfork trading with our gamified learning platform
            </p>
            <div id="tradeStatus" class="mt-4 hidden">
                <span class="discipline-badge">
                    <i class="fas fa-bullseye mr-1"></i>
                    Trade in Progress - Stay Disciplined!
                </span>
            </div>
        </div>

        <!-- Progress Stars -->
        <div class="flex justify-center mb-8">
            <div class="flex gap-2">
                <div id="star1" class="text-3xl text-gray-400 transition-all duration-300">‚òÖ</div>
                <div id="star2" class="text-3xl text-gray-400 transition-all duration-300">‚òÖ</div>
                <div id="star3" class="text-3xl text-gray-400 transition-all duration-300">‚òÖ</div>
                <div id="star4" class="text-3xl text-gray-400 transition-all duration-300">‚òÖ</div>
                <div id="star5" class="text-3xl text-gray-400 transition-all duration-300">‚òÖ</div>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="flex flex-wrap gap-2 mb-8 justify-center">
            <button class="tab-button bg-white text-indigo-600 px-6 py-3 rounded-full font-semibold shadow-lg flex items-center gap-2 active" data-tab="strategy">
                <i class="fas fa-graduation-cap"></i>
                <span class="hidden sm:inline">Strategy Guide</span>
            </button>
            <button class="tab-button bg-white bg-opacity-20 text-white px-6 py-3 rounded-full font-semibold shadow-lg flex items-center gap-2" data-tab="journal">
                <i class="fas fa-book"></i>
                <span class="hidden sm:inline">Trading Journal</span>
            </button>
            <button class="tab-button bg-white bg-opacity-20 text-white px-6 py-3 rounded-full font-semibold shadow-lg flex items-center gap-2" data-tab="history">
                <i class="fas fa-history"></i>
                <span class="hidden sm:inline">Trade History</span>
            </button>
            <button class="tab-button bg-white bg-opacity-20 text-white px-6 py-3 rounded-full font-semibold shadow-lg flex items-center gap-2" data-tab="stats">
                <i class="fas fa-chart-bar"></i>
                <span class="hidden sm:inline">Statistics</span>
            </button>
            <button class="tab-button bg-white bg-opacity-20 text-white px-6 py-3 rounded-full font-semibold shadow-lg flex items-center gap-2" data-tab="calendar">
                <i class="fas fa-calendar"></i>
                <span class="hidden sm:inline">Calendar</span>
            </button>
        </div>

        <!-- Strategy Guide Tab -->
        <div id="strategy-tab" class="tab-content active">
            <!-- Welcome Section -->
            <div class="glass-effect rounded-2xl p-6 mb-6 shadow-xl">
                <div class="text-center">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Welcome to the Pitchfork Strategy Game!</h2>
                    <p class="text-gray-600 text-lg">Complete each step to earn XP, unlock achievements, and level up your trading skills.</p>
                    <div id="strategyProgress" class="mt-4 hidden">
                        <div class="bg-blue-100 rounded-lg p-3">
                            <p class="text-blue-800 font-semibold">Strategy Progress: <span id="strategySteps">0/5</span> steps completed</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Level 1: Market Bias -->
            <div id="trendSection" class="glass-effect rounded-2xl p-6 mb-6 shadow-xl">
                <div class="flex items-center gap-3 mb-6">
                    <div class="bg-indigo-100 rounded-full p-3">
                        <i class="fas fa-chart-line text-indigo-600 text-xl"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800">Level 1: Determine Market Bias</h2>
                    <div class="ml-auto text-sm text-indigo-600 font-semibold">+25 XP</div>
                </div>
               
                <div class="grid md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-blue-50 rounded-xl p-4 border-l-4 border-blue-500">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold">1</span>
                            <span class="font-semibold text-blue-800">Daily Chart Analysis</span>
                        </div>
                        <p class="text-sm text-blue-700">Always start with the daily chart to identify the overall trend</p>
                    </div>
                   
                    <div class="bg-green-50 rounded-xl p-4 border-l-4 border-green-500">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="bg-green-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold">2</span>
                            <span class="font-semibold text-green-800">Trend Direction</span>
                        </div>
                        <p class="text-sm text-green-700">Look for higher highs/lows (uptrend) or lower highs/lows (downtrend)</p>
                    </div>
                   
                    <div class="bg-purple-50 rounded-xl p-4 border-l-4 border-purple-500">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="bg-purple-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold">3</span>
                            <span class="font-semibold text-purple-800">Trade Direction</span>
                        </div>
                        <p class="text-sm text-purple-700">Only trade in the direction of the daily trend</p>
                    </div>
                </div>
               
                <div class="text-center">
                    <button id="trendButton" class="bg-indigo-600 hover:bg-indigo-700 text-white px-8 py-3 rounded-full font-semibold shadow-lg transition-all duration-300 transform hover:scale-105">
                        <i class="fas fa-check mr-2"></i>
                        I've identified the daily trend
                    </button>
                </div>
            </div>

            <!-- Level 2: Timeframe Selection -->
            <div id="timeframeSection" class="glass-effect rounded-2xl p-6 mb-6 shadow-xl hidden">
                <div class="flex items-center gap-3 mb-6">
                    <div class="bg-orange-100 rounded-full p-3">
                        <i class="fas fa-clock text-orange-600 text-xl"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800">Level 2: Select Your Trading Timeframe</h2>
                    <div class="ml-auto text-sm text-orange-600 font-semibold">+25 XP</div>
                </div>
               
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div class="bg-blue-50 rounded-xl p-6 text-center">
                        <i class="fas fa-chart-area text-4xl text-blue-600 mb-4"></i>
                        <h3 class="text-xl font-semibold text-blue-800 mb-2">Swing Trading</h3>
                        <p class="text-blue-700 mb-4">For trades lasting hours to days</p>
                        <button id="hourlyButton" class="timeframe-btn bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-full font-semibold transition-all duration-300">
                            1-Hour Chart
                        </button>
                    </div>
                   
                    <div class="bg-green-50 rounded-xl p-6 text-center">
                        <i class="fas fa-bolt text-4xl text-green-600 mb-4"></i>
                        <h3 class="text-xl font-semibold text-green-800 mb-2">Day Trading</h3>
                        <p class="text-green-700 mb-4">For trades lasting minutes to hours</p>
                        <button id="fiveMinButton" class="timeframe-btn bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-full font-semibold transition-all duration-300">
                            5-Minute Chart
                        </button>
                    </div>
                </div>
            </div>

            <!-- Level 3: Sucker Move -->
            <div id="suckerMoveSection" class="glass-effect rounded-2xl p-6 mb-6 shadow-xl hidden">
                <div class="flex items-center gap-3 mb-6">
                    <div class="bg-red-100 rounded-full p-3">
                        <i class="fas fa-fishing-pole text-red-600 text-xl"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800">Level 3: Identify the Sucker Move</h2>
                    <div class="ml-auto text-sm text-red-600 font-semibold">+30 XP</div>
                </div>
               
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div class="bg-green-50 rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-green-800 mb-3 flex items-center gap-2">
                            <i class="fas fa-arrow-up"></i>
                            Uptrend Setup
                        </h3>
                        <p class="text-green-700 mb-4">Look for 3-5 consecutive red candles near support levels</p>
                        <div class="flex justify-center items-end gap-1">
                            <div class="candlestick">
                                <div class="candle-wick h-2 -top-2"></div>
                                <div class="candle-body red-candle"></div>
                                <div class="candle-wick h-3 -bottom-3"></div>
                            </div>
                            <div class="candlestick">
                                <div class="candle-wick h-2 -top-2"></div>
                                <div class="candle-body red-candle"></div>
                                <div class="candle-wick h-4 -bottom-4"></div>
                            </div>
                            <div class="candlestick">
                                <div class="candle-wick h-3 -top-3"></div>
                                <div class="candle-body red-candle"></div>
                                <div class="candle-wick h-2 -bottom-2"></div>
                            </div>
                            <div class="candlestick">
                                <div class="candle-wick h-6 -top-3"></div>
                                <div class="doji-candle"></div>
                                <div class="candle-wick h-6 -bottom-3"></div>
                            </div>
                        </div>
                    </div>
                   
                    <div class="bg-red-50 rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-red-800 mb-3 flex items-center gap-2">
                            <i class="fas fa-arrow-down"></i>
                            Downtrend Setup
                        </h3>
                        <p class="text-red-700 mb-4">Look for 3-5 consecutive green candles near resistance levels</p>
                        <div class="flex justify-center items-end gap-1">
                            <div class="candlestick">
                                <div class="candle-wick h-3 -top-3"></div>
                                <div class="candle-body green-candle"></div>
                                <div class="candle-wick h-2 -bottom-2"></div>
                            </div>
                            <div class="candlestick">
                                <div class="candle-wick h-4 -top-4"></div>
                                <div class="candle-body green-candle"></div>
                                <div class="candle-wick h-2 -bottom-2"></div>
                            </div>
                            <div class="candlestick">
                                <div class="candle-wick h-2 -top-2"></div>
                                <div class="candle-body green-candle"></div>
                                <div class="candle-wick h-3 -bottom-3"></div>
                            </div>
                            <div class="candlestick">
                                <div class="candle-wick h-6 -top-3"></div>
                                <div class="doji-candle"></div>
                                <div class="candle-wick h-6 -bottom-3"></div>
                            </div>
                        </div>
                    </div>
                </div>
               
                <div class="text-center">
                    <button id="suckerMoveButton" class="bg-red-600 hover:bg-red-700 text-white px-8 py-3 rounded-full font-semibold shadow-lg transition-all duration-300 transform hover:scale-105">
                        <i class="fas fa-check mr-2"></i>
                        I've identified the sucker move
                    </button>
                </div>
            </div>

            <!-- Level 4: Pitchfork Setup -->
            <div id="pitchforkSection" class="glass-effect rounded-2xl p-6 mb-6 shadow-xl hidden">
                <div class="flex items-center gap-3 mb-6">
                    <div class="bg-yellow-100 rounded-full p-3">
                        <i class="fas fa-tools text-yellow-600 text-xl"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800">Level 4: Draw the Pitchfork</h2>
                    <div class="ml-auto text-sm text-yellow-600 font-semibold">+35 XP</div>
                </div>
               
                <div class="bg-yellow-50 rounded-xl p-6 mb-6">
                    <h3 class="text-lg font-semibold text-yellow-800 mb-4">Pitchfork Drawing Steps:</h3>
                    <div class="grid md:grid-cols-3 gap-4">
                        <div class="text-center">
                            <div class="bg-yellow-200 rounded-full w-12 h-12 flex items-center justify-center mx-auto mb-2">
                                <span class="font-bold text-yellow-800">A</span>
                            </div>
                            <p class="text-sm text-yellow-700">First significant high/low</p>
                        </div>
                        <div class="text-center">
                            <div class="bg-yellow-200 rounded-full w-12 h-12 flex items-center justify-center mx-auto mb-2">
                                <span class="font-bold text-yellow-800">B</span>
                            </div>
                            <p class="text-sm text-yellow-700">Opposite swing point</p>
                        </div>
                        <div class="text-center">
                            <div class="bg-yellow-200 rounded-full w-12 h-12 flex items-center justify-center mx-auto mb-2">
                                <span class="font-bold text-yellow-800">C</span>
                            </div>
                            <p class="text-sm text-yellow-700">Third point in trend direction</p>
                        </div>
                    </div>
                </div>
               
                <div class="text-center">
                    <button id="pitchforkButton" class="bg-yellow-600 hover:bg-yellow-700 text-white px-8 py-3 rounded-full font-semibold shadow-lg transition-all duration-300 transform hover:scale-105">
                        <i class="fas fa-check mr-2"></i>
                        I've drawn the pitchfork
                    </button>
                </div>
            </div>

            <!-- Level 5: Entry Signal -->
            <div id="entrySection" class="glass-effect rounded-2xl p-6 mb-6 shadow-xl hidden">
                <div class="flex items-center gap-3 mb-6">
                    <div class="bg-green-100 rounded-full p-3">
                        <i class="fas fa-bullseye text-green-600 text-xl"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800">Level 5: Wait for Entry Signal</h2>
                    <div class="ml-auto text-sm text-green-600 font-semibold">+40 XP</div>
                </div>
               
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div class="bg-green-50 rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-green-800 mb-3">Entry Criteria:</h3>
                        <ul class="space-y-2 text-green-700">
                            <li class="flex items-center gap-2">
                                <i class="fas fa-check-circle text-green-600"></i>
                                Price touches median line
                            </li>
                            <li class="flex items-center gap-2">
                                <i class="fas fa-check-circle text-green-600"></i>
                                Reversal candlestick pattern
                            </li>
                            <li class="flex items-center gap-2">
                                <i class="fas fa-check-circle text-green-600"></i>
                                Volume confirmation
                            </li>
                        </ul>
                    </div>
                   
                    <div class="bg-blue-50 rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-blue-800 mb-3">Risk Management:</h3>
                        <ul class="space-y-2 text-blue-700">
                            <li class="flex items-center gap-2">
                                <i class="fas fa-shield-alt text-blue-600"></i>
                                Stop loss below/above median line
                            </li>
                            <li class="flex items-center gap-2">
                                <i class="fas fa-target text-blue-600"></i>
                                Take profit at channel boundaries
                            </li>
                            <li class="flex items-center gap-2">
                                <i class="fas fa-percentage text-blue-600"></i>
                                Risk max 2% per trade
                            </li>
                        </ul>
                    </div>
                </div>
               
                <div class="text-center space-y-4">
                    <button id="entryButton" class="bg-green-600 hover:bg-green-700 text-white px-8 py-3 rounded-full font-semibold shadow-lg transition-all duration-300 transform hover:scale-105">
                        <i class="fas fa-check mr-2"></i>
                        I understand the entry criteria
                    </button>
                </div>
            </div>

            <!-- Trade Completion Section -->
            <div id="tradeCompletionSection" class="glass-effect rounded-2xl p-6 mb-6 shadow-xl hidden">
                <div class="text-center">
                    <div class="bg-gradient-to-r from-green-400 to-blue-500 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-rocket text-white text-3xl"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Strategy Complete!</h2>
                    <p class="text-gray-600 text-lg mb-6">You've completed all strategy steps. Now you can execute your trade with confidence!</p>
                    
                    <div class="flex flex-col sm:flex-row gap-4 justify-center">
                        <button id="completeTradeButton" class="strategy-complete text-white px-8 py-3 rounded-full font-semibold shadow-lg transition-all duration-300 transform hover:scale-105">
                            <i class="fas fa-chart-line mr-2"></i>
                            Complete Trade (+50 XP)
                        </button>
                        <button id="startNewTradeButton" class="bg-purple-600 hover:bg-purple-700 text-white px-8 py-3 rounded-full font-semibold shadow-lg transition-all duration-300 transform hover:scale-105">
                            <i class="fas fa-redo mr-2"></i>
                            Start New Trade
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Trading Journal Tab -->
        <div id="journal-tab" class="tab-content">
            <div class="glass-effect rounded-2xl p-6 mb-6 shadow-xl">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-3">
                    <i class="fas fa-book text-indigo-600"></i>
                    Trading Journal
                    <div class="ml-auto text-sm text-indigo-600 font-semibold">+20 XP per trade</div>
                </h2>
               
                <form id="journalForm" class="space-y-6">
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Date & Time</label>
                            <input type="datetime-local" id="tradeDate" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Trading Pair</label>
                            <select id="tradeSymbol" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                <option value="">Select Trading Pair</option>
                                <option value="BTC/USDT">BTC/USDT</option>
                                <option value="ETH/USDT">ETH/USDT</option>
                                <option value="SOL/USDT">SOL/USDT</option>
                                <option value="BNB/USDT">BNB/USDT</option>
                            </select>
                        </div>
                    </div>
                   
                    <div class="grid md:grid-cols-3 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Direction</label>
                            <select id="tradeDirection" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                <option value="">Select Direction</option>
                                <option value="long">Long</option>
                                <option value="short">Short</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Entry Price</label>
                            <input type="number" id="entryPrice" step="0.00001" placeholder="0.00000" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Exit Price</label>
                            <input type="number" id="exitPrice" step="0.00001" placeholder="0.00000" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        </div>
                    </div>
                   
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Position Size</label>
                            <input type="number" id="positionSize" step="0.01" placeholder="0.00" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">P&L</label>
                            <input type="number" id="tradePnL" step="0.01" placeholder="0.00" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        </div>
                    </div>
                   
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Trade Notes</label>
                        <textarea id="tradeNotes" rows="4" placeholder="Describe your trade setup, reasoning, and lessons learned..." class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"></textarea>
                    </div>
                   
                    <div class="flex flex-wrap items-center gap-4">
                        <label class="block text-sm font-medium text-gray-700">Emotion Rating:</label>
                        <div class="flex gap-2">
                            <button type="button" class="emotion-btn text-2xl" data-emotion="1">üò§</button>
                            <button type="button" class="emotion-btn text-2xl" data-emotion="2">üòü</button>
                            <button type="button" class="emotion-btn text-2xl" data-emotion="3">üòê</button>
                            <button type="button" class="emotion-btn text-2xl" data-emotion="4">üòä</button>
                            <button type="button" class="emotion-btn text-2xl" data-emotion="5">üòÑ</button>
                        </div>
                        <span id="emotionValue" class="text-sm text-gray-600">Not selected</span>
                    </div>

                    <div class="flex items-center gap-4">
                        <label class="block text-sm font-medium text-gray-700">Trade Rating:</label>
                        <div class="star-rating" id="tradeRating">
                            <span class="star" data-rating="1">‚òÖ</span>
                            <span class="star" data-rating="2">‚òÖ</span>
                            <span class="star" data-rating="3">‚òÖ</span>
                            <span class="star" data-rating="4">‚òÖ</span>
                            <span class="star" data-rating="5">‚òÖ</span>
                        </div>
                        <span id="ratingValue" class="text-sm text-gray-600">Not rated</span>
                    </div>

                    <div class="bg-blue-50 rounded-lg p-4">
                        <h4 class="font-semibold text-blue-800 mb-2">Strategy Adherence Check:</h4>
                        <div class="space-y-2">
                            <label class="flex items-center gap-2">
                                <input type="checkbox" id="checkTrend" class="strategy-check">
                                <span class="text-blue-700">I identified the daily trend correctly</span>
                            </label>
                            <label class="flex items-center gap-2">
                                <input type="checkbox" id="checkTimeframe" class="strategy-check">
                                <span class="text-blue-700">I selected the appropriate timeframe</span>
                            </label>
                            <label class="flex items-center gap-2">
                                <input type="checkbox" id="checkSucker" class="strategy-check">
                                <span class="text-blue-700">I identified the sucker move</span>
                            </label>
                            <label class="flex items-center gap-2">
                                <input type="checkbox" id="checkPitchfork" class="strategy-check">
                                <span class="text-blue-700">I drew the pitchfork correctly</span>
                            </label>
                            <label class="flex items-center gap-2">
                                <input type="checkbox" id="checkEntry" class="strategy-check">
                                <span class="text-blue-700">I waited for proper entry signal</span>
                            </label>
                        </div>
                        <div class="mt-3">
                            <span class="text-sm text-blue-600 font-semibold">Discipline Bonus: +<span id="disciplineBonus">0</span> XP</span>
                        </div>
                    </div>
                   
                    <div class="text-center">
                        <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white px-8 py-3 rounded-full font-semibold shadow-lg transition-all duration-300 transform hover:scale-105">
                            <i class="fas fa-save mr-2"></i>
                            Save Trade
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Trade History Tab -->
        <div id="history-tab" class="tab-content">
            <div class="glass-effect rounded-2xl p-6 shadow-xl">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-3">
                    <i class="fas fa-history text-indigo-600"></i>
                    Trade History
                    <div class="ml-auto text-sm text-indigo-600 font-semibold">+5 XP per review</div>
                </h2>
               
                <div id="tradeHistoryContainer">
                    <div class="text-center py-12 text-gray-500">
                        <i class="fas fa-chart-line text-4xl mb-4"></i>
                        <p class="text-lg">No trades recorded yet</p>
                        <p class="text-sm">Start by adding trades in the Trading Journal</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics Tab -->
        <div id="stats-tab" class="tab-content">
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="stat-card glass-effect rounded-2xl p-6 text-center shadow-xl">
                    <div class="bg-green-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-chart-line text-2xl text-green-600"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800" id="totalTrades">0</h3>
                    <p class="text-gray-600">Total Trades</p>
                </div>
               
                <div class="stat-card glass-effect rounded-2xl p-6 text-center shadow-xl">
                    <div class="bg-blue-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-percentage text-2xl text-blue-600"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800" id="winRate">0%</h3>
                    <p class="text-gray-600">Win Rate</p>
                </div>
               
                <div class="stat-card glass-effect rounded-2xl p-6 text-center shadow-xl">
                    <div class="bg-purple-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-dollar-sign text-2xl text-purple-600"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800" id="totalPnL">$0.00</h3>
                    <p class="text-gray-600">Total P&L</p>
                </div>
               
                <div class="stat-card glass-effect rounded-2xl p-6 text-center shadow-xl">
                    <div class="bg-orange-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-trophy text-2xl text-orange-600"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800" id="bestTrade">$0.00</h3>
                    <p class="text-gray-600">Best Trade</p>
                </div>
            </div>

            <div class="grid md:grid-cols-2 gap-6 mb-8">
                <div class="stat-card glass-effect rounded-2xl p-6 text-center shadow-xl">
                    <div class="bg-indigo-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-star text-2xl text-indigo-600"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800" id="avgRating">0.0</h3>
                    <p class="text-gray-600">Average Trade Rating</p>
                </div>
               
                <div class="stat-card glass-effect rounded-2xl p-6 text-center shadow-xl">
                    <div class="bg-green-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-chart-line text-2xl text-green-600"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800" id="disciplineAvg">100%</h3>
                    <p class="text-gray-600">Strategy Discipline</p>
                </div>
            </div>
           
            <div class="glass-effect rounded-2xl p-6 shadow-xl">
                <h3 class="text-xl font-bold text-gray-800 mb-4">Performance Chart</h3>
                <canvas id="performanceChart" width="400" height="200"></canvas>
            </div>
        </div>

        <!-- Calendar Tab -->
        <div id="calendar-tab" class="tab-content">
            <div class="glass-effect rounded-2xl p-6 shadow-xl">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-3">
                    <i class="fas fa-calendar text-indigo-600"></i>
                    Trading Calendar
                    <div class="ml-auto text-sm text-indigo-600 font-semibold">+2 XP per day visited</div>
                </h2>
               
                <div class="grid grid-cols-7 gap-2 mb-4">
                    <div class="text-center font-semibold text-gray-700 p-2">Sun</div>
                    <div class="text-center font-semibold text-gray-700 p-2">Mon</div>
                    <div class="text-center font-semibold text-gray-700 p-2">Tue</div>
                    <div class="text-center font-semibold text-gray-700 p-2">Wed</div>
                    <div class="text-center font-semibold text-gray-700 p-2">Thu</div>
                    <div class="text-center font-semibold text-gray-700 p-2">Fri</div>
                    <div class="text-center font-semibold text-gray-700 p-2">Sat</div>
                </div>
               
                <div id="calendarGrid" class="grid grid-cols-7 gap-2">
                    <!-- Calendar days will be generated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            xp: 0,
            level: 1,
            streak: 0,
            currentStep: 0,
            trades: JSON.parse(localStorage.getItem('trades') || '[]'),
            selectedEmotion: null,
            selectedRating: 0,
            disciplineScore: 100,
            strategyCompleted: false,
            tradeInProgress: false,
            visitedDays: JSON.parse(localStorage.getItem('visitedDays') || '[]'),
            editingTradeId: null
        };

        // Achievements
        const achievements = [
            { id: 'first_step', title: 'First Steps', desc: 'Completed your first level', xp: 25 },
            { id: 'trend_master', title: 'Trend Master', desc: 'Identified market bias', xp: 25 },
            { id: 'timeframe_pro', title: 'Timeframe Pro', desc: 'Selected trading timeframe', xp: 25 },
            { id: 'sucker_spotter', title: 'Sucker Spotter', desc: 'Identified sucker move', xp: 30 },
            { id: 'pitchfork_artist', title: 'Pitchfork Artist', desc: 'Drew your first pitchfork', xp: 35 },
            { id: 'entry_expert', title: 'Entry Expert', desc: 'Mastered entry signals', xp: 40 },
            { id: 'strategy_complete', title: 'Strategy Master', desc: 'Completed full strategy', xp: 50 },
            { id: 'first_trade', title: 'First Trade', desc: 'Recorded your first trade', xp: 20 },
            { id: 'disciplined_trader', title: 'Disciplined Trader', desc: 'Perfect strategy adherence', xp: 50 },
            { id: 'streak_5', title: 'Hot Streak', desc: '5 day trading streak', xp: 100 },
            { id: 'perfectionist', title: 'Perfectionist', desc: 'Rated a trade 5 stars', xp: 30 },
            { id: 'reviewer', title: 'Trade Reviewer', desc: 'Reviewed 10 trades', xp: 75 }
        ];

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadGameState();
            updateUI();
            initializeEventListeners();
            generateCalendar();
            updateStatistics();
            initializeChart();
            updateStrategyProgress();
        });

        // Event Listeners
        function initializeEventListeners() {
            // Tab navigation
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', function() {
                    switchTab(this.dataset.tab);
                    awardTabVisitXP(this.dataset.tab);
                });
            });

            // Game progression buttons
            document.getElementById('trendButton').addEventListener('click', () => completeStep(1));
            document.getElementById('hourlyButton').addEventListener('click', () => completeStep(2));
            document.getElementById('fiveMinButton').addEventListener('click', () => completeStep(2));
            document.getElementById('suckerMoveButton').addEventListener('click', () => completeStep(3));
            document.getElementById('pitchforkButton').addEventListener('click', () => completeStep(4));
            document.getElementById('entryButton').addEventListener('click', () => completeStep(5));

            // Trade completion buttons
            document.getElementById('completeTradeButton').addEventListener('click', completeTrade);
            document.getElementById('startNewTradeButton').addEventListener('click', startNewTrade);

            // Journal form
            document.getElementById('journalForm').addEventListener('submit', handleTradeSubmission);

            // Emotion buttons
            document.querySelectorAll('.emotion-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    selectEmotion(this.dataset.emotion);
                });
            });

            // Star rating
            document.querySelectorAll('.star').forEach(star => {
                star.addEventListener('click', function() {
                    selectRating(this.dataset.rating);
                });
            });

            // Strategy adherence checkboxes
            document.querySelectorAll('.strategy-check').forEach(checkbox => {
                checkbox.addEventListener('change', updateDisciplineBonus);
            });

            // Set current date/time
            document.getElementById('tradeDate').value = new Date().toISOString().slice(0, 16);
        }

        // Tab switching with XP rewards
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active', 'bg-white', 'text-indigo-600');
                btn.classList.add('bg-white', 'bg-opacity-20', 'text-white');
            });
            
            document.querySelector(`[data-tab="${tabName}"]`).classList.remove('bg-white', 'bg-opacity-20', 'text-white');
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active', 'bg-white', 'text-indigo-600');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }

        function awardTabVisitXP(tabName) {
            const xpRewards = {
                'strategy': 5,
                'journal': 10,
                'history': 5,
                'stats': 8,
                'calendar': 2
            };
            
            if (xpRewards[tabName]) {
                addXP(xpRewards[tabName]);
            }
        }

        // Game progression
        function completeStep(step) {
            if (step > gameState.currentStep) {
                gameState.currentStep = step;
                const achievement = achievements[step - 1];
                addXP(achievement.xp);
                showAchievement(achievement);
                updateStars();
                showNextSection(step);
                updateStrategyProgress();
                
                if (step === 5) {
                    gameState.strategyCompleted = true;
                    document.getElementById('tradeCompletionSection').classList.remove('hidden');
                    document.getElementById('tradeStatus').classList.remove('hidden');
                    gameState.tradeInProgress = true;
                }
                
                saveGameState();
            }
        }

        function completeTrade() {
            if (gameState.strategyCompleted) {
                addXP(50);
                showAchievement(achievements.find(a => a.id === 'strategy_complete'));
                switchTab('journal');
                gameState.tradeInProgress = false;
                document.getElementById('tradeStatus').classList.add('hidden');
                saveGameState();
            }
        }

        function startNewTrade() {
            // Reset strategy progress
            gameState.currentStep = 0;
            gameState.strategyCompleted = false;
            gameState.tradeInProgress = false;
            
            // Hide all sections except first
            document.getElementById('timeframeSection').classList.add('hidden');
            document.getElementById('suckerMoveSection').classList.add('hidden');
            document.getElementById('pitchforkSection').classList.add('hidden');
            document.getElementById('entrySection').classList.add('hidden');
            document.getElementById('tradeCompletionSection').classList.add('hidden');
            document.getElementById('tradeStatus').classList.add('hidden');
            
            // Reset stars
            updateStars();
            updateStrategyProgress();
            
            // Switch to strategy tab
            switchTab('strategy');
            
            // Scroll to top
            window.scrollTo(0, 0);
            
            saveGameState();
        }

        function updateStrategyProgress() {
            const progressElement = document.getElementById('strategyProgress');
            const stepsElement = document.getElementById('strategySteps');
            
            if (gameState.currentStep > 0) {
                progressElement.classList.remove('hidden');
                stepsElement.textContent = `${gameState.currentStep}/5`;
            } else {
                progressElement.classList.add('hidden');
            }
        }

        function showNextSection(step) {
            const sections = [
                'trendSection',
                'timeframeSection', 
                'suckerMoveSection',
                'pitchforkSection',
                'entrySection'
            ];
            
            if (step < sections.length) {
                document.getElementById(sections[step]).classList.remove('hidden');
                document.getElementById(sections[step]).scrollIntoView({ behavior: 'smooth' });
            }
        }

        function updateStars() {
            for (let i = 1; i <= 5; i++) {
                const star = document.getElementById(`star${i}`);
                if (i <= gameState.currentStep) {
                    star.classList.remove('text-gray-400');
                    star.classList.add('text-yellow-400');
                } else {
                    star.classList.remove('text-yellow-400');
                    star.classList.add('text-gray-400');
                }
            }
        }

        // XP and leveling system
        function addXP(amount) {
            gameState.xp += amount;
            const newLevel = Math.floor(gameState.xp / 500) + 1;
            
            if (newLevel > gameState.level) {
                gameState.level = newLevel;
                createConfetti();
            }
            
            updateUI();
        }

        function updateUI() {
            document.getElementById('xpValue').textContent = gameState.xp;
            document.getElementById('levelValue').textContent = gameState.level;
            document.getElementById('streakValue').textContent = gameState.streak;
            document.getElementById('disciplineScore').textContent = `${gameState.disciplineScore}%`;
            
            const progress = (gameState.xp % 500) / 500 * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
            document.getElementById('progressText').textContent = `${Math.round(progress)}%`;
        }

        // Achievement system
        function showAchievement(achievement) {
            const popup = document.getElementById('achievementPopup');
            document.getElementById('achievementTitle').textContent = achievement.title;
            document.getElementById('achievementDesc').textContent = achievement.desc;
            document.getElementById('achievementXP').textContent = achievement.xp;
            
            popup.classList.remove('translate-x-full', 'opacity-0');
            popup.classList.add('translate-x-0', 'opacity-100');
            
            setTimeout(() => {
                popup.classList.add('translate-x-full', 'opacity-0');
                popup.classList.remove('translate-x-0', 'opacity-100');
            }, 4000);
        }

        // Confetti effect
        function createConfetti() {
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.backgroundColor = ['#f39c12', '#e74c3c', '#3498db', '#2ecc71', '#9b59b6'][Math.floor(Math.random() * 5)];
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => confetti.remove(), 3000);
                }, i * 50);
            }
        }

        // Trading journal
        function selectEmotion(emotion) {
            gameState.selectedEmotion = emotion;
            document.querySelectorAll('.emotion-btn').forEach(btn => {
                btn.style.transform = 'scale(1)';
                btn.style.opacity = '0.6';
            });
            
            const selectedBtn = document.querySelector(`[data-emotion="${emotion}"]`);
            selectedBtn.style.transform = 'scale(1.2)';
            selectedBtn.style.opacity = '1';
            
            const emotions = ['Angry', 'Worried', 'Neutral', 'Happy', 'Excited'];
            document.getElementById('emotionValue').textContent = emotions[emotion - 1];
        }

        function selectRating(rating) {
            gameState.selectedRating = parseInt(rating);
            document.querySelectorAll('.star').forEach((star, index) => {
                if (index < rating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
            
            document.getElementById('ratingValue').textContent = `${rating} star${rating > 1 ? 's' : ''}`;
            
            if (rating == 5) {
                addXP(30);
                showAchievement(achievements.find(a => a.id === 'perfectionist'));
            }
        }

        function updateDisciplineBonus() {
            const checkboxes = document.querySelectorAll('.strategy-check');
            const checkedCount = document.querySelectorAll('.strategy-check:checked').length;
            const bonus = checkedCount * 10;
            
            document.getElementById('disciplineBonus').textContent = bonus;
            
            if (checkedCount === 5) {
                addXP(50);
                showAchievement(achievements.find(a => a.id === 'disciplined_trader'));
            }
        }

        function handleTradeSubmission(e) {
            e.preventDefault();
            
            const checkboxes = document.querySelectorAll('.strategy-check:checked');
            const disciplineScore = (checkboxes.length / 5) * 100;
            const disciplineBonus = checkboxes.length * 10;
            
            const trade = {
                id: gameState.editingTradeId || Date.now(),
                date: document.getElementById('tradeDate').value,
                symbol: document.getElementById('tradeSymbol').value,
                direction: document.getElementById('tradeDirection').value,
                entryPrice: parseFloat(document.getElementById('entryPrice').value),
                exitPrice: parseFloat(document.getElementById('exitPrice').value),
                positionSize: parseFloat(document.getElementById('positionSize').value),
                pnl: parseFloat(document.getElementById('tradePnL').value),
                notes: document.getElementById('tradeNotes').value,
                emotion: gameState.selectedEmotion,
                rating: gameState.selectedRating,
                disciplineScore: disciplineScore,
                disciplineBonus: disciplineBonus
            };
            
            if (gameState.editingTradeId) {
                // Update existing trade
                const index = gameState.trades.findIndex(t => t.id === gameState.editingTradeId);
                gameState.trades[index] = trade;
                gameState.editingTradeId = null;
            } else {
                // Add new trade
                gameState.trades.push(trade);
                addXP(20 + disciplineBonus); // Base XP + discipline bonus
            }
            
            // Update discipline score
            const allScores = gameState.trades.map(t => t.disciplineScore);
            gameState.disciplineScore = Math.round(allScores.reduce((a, b) => a + b, 0) / allScores.length);
            
            saveGameState();
            
            // Reset form
            resetJournalForm();
            
            // Award achievement for first trade
            if (gameState.trades.length === 1) {
                showAchievement(achievements.find(a => a.id === 'first_trade'));
            }
            
            updateTradeHistory();
            updateStatistics();
            
            // Show success message
            alert('Trade saved successfully!');
        }

        function resetJournalForm() {
            document.getElementById('journalForm').reset();
            gameState.selectedEmotion = null;
            gameState.selectedRating = 0;
            document.getElementById('emotionValue').textContent = 'Not selected';
            document.getElementById('ratingValue').textContent = 'Not rated';
            document.getElementById('disciplineBonus').textContent = '0';
            
            document.querySelectorAll('.emotion-btn').forEach(btn => {
                btn.style.transform = 'scale(1)';
                btn.style.opacity = '1';
            });
            
            document.querySelectorAll('.star').forEach(star => {
                star.classList.remove('active');
            });
            
            document.querySelectorAll('.strategy-check').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            document.getElementById('tradeDate').value = new Date().toISOString().slice(0, 16);
        }

        function editTrade(tradeId) {
            const trade = gameState.trades.find(t => t.id === tradeId);
            if (!trade) return;
            
            gameState.editingTradeId = tradeId;
            
            // Fill form with trade data
            document.getElementById('tradeDate').value = trade.date;
            document.getElementById('tradeSymbol').value = trade.symbol;
            document.getElementById('tradeDirection').value = trade.direction;
            document.getElementById('entryPrice').value = trade.entryPrice;
            document.getElementById('exitPrice').value = trade.exitPrice;
            document.getElementById('positionSize').value = trade.positionSize;
            document.getElementById('tradePnL').value = trade.pnl;
            document.getElementById('tradeNotes').value = trade.notes;
            
            if (trade.emotion) {
                selectEmotion(trade.emotion);
            }
            
            if (trade.rating) {
                selectRating(trade.rating);
            }
            
            // Switch to journal tab
            switchTab('journal');
            
            // Scroll to form
            document.getElementById('journal-tab').scrollIntoView({ behavior: 'smooth' });
        }

        function deleteTrade(tradeId) {
            if (confirm('Are you sure you want to delete this trade?')) {
                gameState.trades = gameState.trades.filter(t => t.id !== tradeId);
                saveGameState();
                updateTradeHistory();
                updateStatistics();
                
                // Recalculate discipline score
                if (gameState.trades.length > 0) {
                    const allScores = gameState.trades.map(t => t.disciplineScore);
                    gameState.disciplineScore = Math.round(allScores.reduce((a, b) => a + b, 0) / allScores.length);
                } else {
                    gameState.disciplineScore = 100;
                }
                
                updateUI();
            }
        }

        function updateTradeHistory() {
            const container = document.getElementById('tradeHistoryContainer');
            
            if (gameState.trades.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12 text-gray-500">
                        <i class="fas fa-chart-line text-4xl mb-4"></i>
                        <p class="text-lg">No trades recorded yet</p>
                        <p class="text-sm">Start by adding trades in the Trading Journal</p>
                    </div>
                `;
                return;
            }
            
            const tradesHTML = gameState.trades.map(trade => `
                <div class="trade-entry bg-white rounded-lg p-4 mb-4 shadow-md">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <h4 class="font-semibold text-lg">${trade.symbol}</h4>
                            <p class="text-sm text-gray-600">${new Date(trade.date).toLocaleString()}</p>
                        </div>
                        <div class="text-right">
                            <span class="inline-block px-2 py-1 rounded text-sm font-semibold ${trade.direction === 'long' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                ${trade.direction.toUpperCase()}
                            </span>
                            <p class="text-lg font-bold ${trade.pnl >= 0 ? 'text-green-600' : 'text-red-600'}">
                                ${trade.pnl >= 0 ? '+' : ''}$${trade.pnl.toFixed(2)}
                            </p>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4 text-sm text-gray-600 mb-2">
                        <div>Entry: ${trade.entryPrice}</div>
                        <div>Exit: ${trade.exitPrice}</div>
                        <div>Size: ${trade.positionSize}</div>
                        <div>Emotion: ${trade.emotion ? ['üò§', 'üòü', 'üòê', 'üòä', 'üòÑ'][trade.emotion - 1] : 'N/A'}</div>
                    </div>
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center gap-2">
                            <span class="text-sm text-gray-600">Rating:</span>
                            <div class="flex">
                                ${Array.from({length: 5}, (_, i) => 
                                    `<span class="text-yellow-400">${i < (trade.rating || 0) ? '‚òÖ' : '‚òÜ'}</span>`
                                ).join('')}
                            </div>
                        </div>
                        <div class="text-sm text-gray-600">
                            Discipline: <span class="font-semibold ${trade.disciplineScore >= 80 ? 'text-green-600' : trade.disciplineScore >= 60 ? 'text-yellow-600' : 'text-red-600'}">${trade.disciplineScore}%</span>
                        </div>
                    </div>
                    ${trade.notes ? `<p class="text-sm text-gray-700 italic mb-3">"${trade.notes}"</p>` : ''}
                    <div class="flex gap-2">
                        <button onclick="editTrade(${trade.id})" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm transition-colors">
                            <i class="fas fa-edit mr-1"></i>Edit
                        </button>
                        <button onclick="deleteTrade(${trade.id})" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm transition-colors">
                            <i class="fas fa-trash mr-1"></i>Delete
                        </button>
                        <button onclick="reviewTrade(${trade.id})" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm transition-colors">
                            <i class="fas fa-eye mr-1"></i>Review (+5 XP)
                        </button>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = tradesHTML;
        }

        function reviewTrade(tradeId) {
            addXP(5);
            
            // Check for reviewer achievement
            const reviewCount = parseInt(localStorage.getItem('reviewCount') || '0') + 1;
            localStorage.setItem('reviewCount', reviewCount.toString());
            
            if (reviewCount >= 10) {
                showAchievement(achievements.find(a => a.id === 'reviewer'));
            }
        }

        function updateStatistics() {
            const totalTrades = gameState.trades.length;
            const winningTrades = gameState.trades.filter(t => t.pnl > 0).length;
            const winRate = totalTrades > 0 ? (winningTrades / totalTrades * 100).toFixed(1) : 0;
            const totalPnL = gameState.trades.reduce((sum, t) => sum + t.pnl, 0);
            const bestTrade = totalTrades > 0 ? Math.max(...gameState.trades.map(t => t.pnl)) : 0;
            const avgRating = totalTrades > 0 ? (gameState.trades.reduce((sum, t) => sum + (t.rating || 0), 0) / totalTrades).toFixed(1) : 0;
            const disciplineAvg = totalTrades > 0 ? Math.round(gameState.trades.reduce((sum, t) => sum + t.disciplineScore, 0) / totalTrades) : 100;
            
            document.getElementById('totalTrades').textContent = totalTrades;
            document.getElementById('winRate').textContent = `${winRate}%`;
            document.getElementById('totalPnL').textContent = `$${totalPnL.toFixed(2)}`;
            document.getElementById('bestTrade').textContent = `$${bestTrade.toFixed(2)}`;
            document.getElementById('avgRating').textContent = avgRating;
            document.getElementById('disciplineAvg').textContent = `${disciplineAvg}%`;
        }

        function initializeChart() {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: gameState.trades.map((_, i) => `Trade ${i + 1}`),
                    datasets: [{
                        label: 'Cumulative P&L',
                        data: gameState.trades.reduce((acc, trade, i) => {
                            const cumulative = i === 0 ? trade.pnl : acc[i - 1] + trade.pnl;
                            acc.push(cumulative);
                            return acc;
                        }, []),
                        borderColor: '#4f46e5',
                        backgroundColor: 'rgba(79, 70, 229, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function generateCalendar() {
            const grid = document.getElementById('calendarGrid');
            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
            
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            
            grid.innerHTML = '';
            
            // Empty cells for days before month starts
            for (let i = 0; i < firstDay; i++) {
                const cell = document.createElement('div');
                cell.className = 'p-2';
                grid.appendChild(cell);
            }
            
            // Days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const cell = document.createElement('div');
                cell.className = 'p-2 text-center border border-gray-200 rounded hover:bg-gray-50 cursor-pointer';
                cell.textContent = day;
                
                // Highlight today
                if (day === today.getDate()) {
                    cell.classList.add('bg-indigo-100', 'text-indigo-800', 'font-semibold');
                }
                
                // Check if there are trades on this day
                const dayTrades = gameState.trades.filter(trade => {
                    const tradeDate = new Date(trade.date);
                    return tradeDate.getDate() === day && 
                           tradeDate.getMonth() === currentMonth && 
                           tradeDate.getFullYear() === currentYear;
                });
                
                if (dayTrades.length > 0) {
                    const totalPnL = dayTrades.reduce((sum, t) => sum + t.pnl, 0);
                    const indicator = document.createElement('div');
                    indicator.className = `w-2 h-2 rounded-full mx-auto mt-1 ${totalPnL >= 0 ? 'bg-green-500' : 'bg-red-500'}`;
                    cell.appendChild(indicator);
                }
                
                // Add click handler for calendar XP
                cell.addEventListener('click', () => {
                    const dayKey = `${currentYear}-${currentMonth}-${day}`;
                    if (!gameState.visitedDays.includes(dayKey)) {
                        gameState.visitedDays.push(dayKey);
                        addXP(2);
                        saveGameState();
                    }
                });
                
                grid.appendChild(cell);
            }
        }

        // Local storage functions
        function saveGameState() {
            localStorage.setItem('gameState', JSON.stringify(gameState));
            localStorage.setItem('trades', JSON.stringify(gameState.trades));
            localStorage.setItem('visitedDays', JSON.stringify(gameState.visitedDays));
        }

        function loadGameState() {
            const saved = localStorage.getItem('gameState');
            if (saved) {
                gameState = { ...gameState, ...JSON.parse(saved) };
            }
            
            const savedTrades = localStorage.getItem('trades');
            if (savedTrades) {
                gameState.trades = JSON.parse(savedTrades);
            }
            
            const savedDays = localStorage.getItem('visitedDays');
            if (savedDays) {
                gameState.visitedDays = JSON.parse(savedDays);
            }
        }
    </script>
</body>
</html>

